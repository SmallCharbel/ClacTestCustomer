<!DOCTYPE html>
<html lang="en">
<head>
  <!-- MSAL Script for Authentication -->
  <script src="https://alcdn.msauth.net/browser/2.30.0/js/msal-browser.min.js"></script>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Microsoft Security Calculator</title>
  <style>
    /* Global Page Styles */
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background-color: #f8fafc;
      margin: 0;
      padding: 0;
      display: flex;
      height: 100vh;
      overflow: hidden;
    }
    .sidebar {
      width: 220px;
      background: linear-gradient(180deg, #30475e 0%, #1f3346 100%);
      color: white;
      display: flex;
      flex-direction: column;
      padding: 20px;
      height: 100vh;
      overflow-y: auto;
      position: fixed;
      left: 0;
      top: 0;
      border-radius: 0 24px 24px 0;
      box-shadow: 2px 0 20px rgba(0, 0, 0, 0.15);
      z-index: 1000;
    }
    .logo {
      width: 100px;
      margin: 0 auto 20px auto;
      transition: transform 0.6s cubic-bezier(0.4, 0, 0.2, 1);
    }
    .logo:hover {
      transform: rotate(360deg) scale(1.05);
    }
    .sidebar a {
      color: white;
      text-decoration: none;
      padding: 14px;
      font-size: 18px;
      margin-bottom: 15px;
      border-radius: 12px;
      background-color: transparent;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      display: block;
      text-align: left;
    }
    .sidebar a:hover {
      background-color: rgba(255, 255, 255, 0.1);
      transform: translateX(8px);
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
    }
    .title-bar {
      position: fixed;
      top: 0;
      left: 260px; /* Adjusted to account for sidebar width + padding */
      right: 400px; /* Adjusted to account for bill summary width */
      z-index: 999;
      padding: 20px 0;
      text-align: center;
      background-color: rgba(255, 255, 255, 0.9);
      backdrop-filter: blur(8px);
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
    }
    .title-bar h1 {
      margin: 0;
      color: #30475e;
      font-size: 32px;
      font-weight: 600;
      letter-spacing: -0.5px;
    }
    .content {
      margin-top: 100px;
      margin-left: 260px; /* Adjusted to match title-bar left margin */
      margin-right: 420px; /* Adjusted to account for bill summary */
      padding: 24px;
      background-color: white;
      overflow-y: auto;
      height: calc(100vh - 140px);
      box-sizing: border-box;
      border-radius: 24px;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
      position: relative;
      z-index: 1;
    }
    .content h2 {
      color: #30475e;
      margin-bottom: 24px;
      font-size: 28px;
      font-weight: 600;
      border-bottom: 3px solid #f0f4f7;
      padding-bottom: 12px;
      padding-left: 20px;
    }
    .service-options,
    .service-details {
      padding: 24px;
      background-color: #ffffff;
      border-radius: 16px;
      box-shadow: 0 4px 16px rgba(0, 0, 0, 0.06);
      margin-bottom: 24px;
      border: 1px solid rgba(0, 0, 0, 0.05);
    }
    input[type="number"] {
      padding: 14px;
      margin-bottom: 20px;
      border: 2px solid #e5e7eb;
      border-radius: 12px;
      font-size: 16px;
      width: calc(100% - 32px);
      transition: border-color 0.2s ease;
      box-sizing: border-box;
    }
    input[type="number"]:focus {
      outline: none;
      border-color: #007bb5;
      box-shadow: 0 0 0 3px rgba(0, 123, 181, 0.1);
    }
    .add-to-bill {
      padding: 14px 28px;
      background: linear-gradient(135deg, #007bb5 0%, #005f8d 100%);
      color: white;
      border: none;
      border-radius: 12px;
      font-size: 18px;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      width: 100%;
      box-sizing: border-box;
    }
    .add-to-bill:hover {
      transform: translateY(-3px);
      box-shadow: 0 6px 20px rgba(0, 123, 181, 0.2);
    }
    .bill-summary {
      width: 380px;
      background-color: #ffffff;
      padding: 30px;
      position: fixed;
      right: 0;
      top: 0;
      height: 100vh;
      overflow-y: auto;
      border-radius: 24px 0 0 24px;
      box-shadow: -4px 0 20px rgba(0, 0, 0, 0.1);
      box-sizing: border-box;
      z-index: 1000;
    }
    .bill-summary h3 {
      color: #2d3e50;
      margin-bottom: 16px;
      font-size: 24px;
      font-weight: 600;
      border-bottom: 2px solid #f4f4f4;
      padding-bottom: 12px;
      text-align: center;
    }
    .bill-summary .bill-item {
      padding: 16px;
      margin-bottom: 16px;
      border: 1px solid #e5e7eb;
      border-radius: 16px;
      display: flex;
      flex-direction: column;
      justify-content: space-between;
      align-items: flex-start;
      transition: transform 0.2s ease;
      width: 100%;
      box-sizing: border-box;
    }
    .bill-summary .bill-item:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
    }
    .bill-summary .item-header {
      display: flex;
      justify-content: space-between;
      width: 100%;
      align-items: center;
    }
    .bill-summary .remove-item {
      color: #dc3545;
      font-weight: bold;
      cursor: pointer;
      padding: 6px 10px;
      border-radius: 8px;
      transition: all 0.2s ease;
    }
    .bill-summary .remove-item:hover {
      background-color: #fff5f5;
      color: #dc3545;
      transform: scale(1.1);
    }
    .bill-summary .item-price {
      font-weight: 600;
      color: #007bb5;
      margin-bottom: 6px;
      font-size: 18px;
    }
    .bill-summary .item-details {
      color: #64748b;
      white-space: normal;
      word-break: break-word;
      line-height: 1.5;
      width: 100%;
    }
    .bill-summary .total-cost {
      font-size: 28px;
      font-weight: 700;
      color: #007bb5;
      text-align: right;
      padding-top: 24px;
      border-top: 2px solid #f4f4f4;
      margin-top: 24px;
      width: 100%;
    }
    .tooltip {
      position: relative;
      display: inline-block;
      margin-left: 8px;
      cursor: help;
    }
    .tooltip .tooltiptext {
      visibility: hidden;
      width: 280px;
      background-color: #1a237e;
      color: #fff;
      text-align: center;
      border-radius: 12px;
      padding: 12px 16px;
      position: absolute;
      z-index: 1;
      bottom: 125%;
      left: 50%;
      margin-left: -140px;
      opacity: 0;
      transition: opacity 0.3s;
      font-size: 14px;
      line-height: 1.5;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
    }
    .tooltip:hover .tooltiptext {
      visibility: visible;
      opacity: 1;
    }
    /* Dynamic Table Styles */
    .dynamic-table-container {
      margin-top: 24px;
      width: 100%;
    }
    .dynamic-table-container label {
      font-weight: 600;
      color: #30475e;
      display: block;
      margin-bottom: 8px;
    }
    .dynamic-table-container select {
      width: 100%;
      padding: 12px;
      font-size: 16px;
      margin-bottom: 24px;
      border: 2px solid #e5e7eb;
      border-radius: 12px;
      transition: all 0.2s ease;
      box-sizing: border-box;
    }
    .dynamic-table-container select:focus {
      outline: none;
      border-color: #007bb5;
      box-shadow: 0 0 0 3px rgba(0, 123, 181, 0.1);
    }
    .dynamic-table-container table {
      width: 100%;
      border-collapse: separate;
      border-spacing: 0;
      margin-bottom: 40px;
      border-radius: 16px;
      overflow: hidden;
      box-shadow: 0 4px 16px rgba(0, 0, 0, 0.08);
    }
    .dynamic-table-container th,
    .dynamic-table-container td {
      padding: 14px 16px;
      text-align: left;
      border: 1px solid #e5e7eb;
    }
    .dynamic-table-container th {
      background: linear-gradient(135deg, #30475e 0%, #1f3346 100%);
      color: #fff;
      font-weight: 600;
      letter-spacing: 0.5px;
    }
    .dynamic-table-container tr:nth-child(even) {
      background-color: #f8fafc;
    }
    .dynamic-table-container tr:hover {
      background-color: #f1f5f9;
      transition: background-color 0.2s ease;
    }
    .section-header {
      background: linear-gradient(135deg, #e5e7eb 0%, #d1d5db 100%);
      font-weight: 600;
      text-align: center;
      color: #1f2937;
    }
    .yes {
      background-color: #dcfce7;
      color: #166534;
      font-weight: 600;
      text-align: center;
    }
    .no {
      background-color: #fee2e2;
      color: #991b1b;
      font-weight: 600;
      text-align: center;
    }
    @media (max-width: 1200px) {
      .content {
        margin-right: 400px;
        margin-left: 240px;
      }
      .title-bar {
        left: 240px;
        right: 400px;
      }
    }
    @media (max-width: 600px) {
      .dynamic-table-container th, 
      .dynamic-table-container td {
        padding: 10px;
        font-size: 14px;
      }
      .dynamic-table-container select {
        font-size: 14px;
      }
    }
    /* Modern License Dropdown Styles */
    .license-container {
      margin-bottom: 24px;
    }

    .license-label {
      display: block;
      font-weight: 600;
      color: #1a237e;
      margin-bottom: 8px;
    }

    .license-select {
      width: 100%;
      padding: 14px;
      font-size: 16px;
      border: 2px solid #e8eaf6;
      border-radius: 12px;
      background-color: white;
      color: #1a237e;
      appearance: none;
      -webkit-appearance: none;
      cursor: pointer;
      transition: all 0.3s ease;
      background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='24' height='24' viewBox='0 0 24 24' fill='none' stroke='%231a237e' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpolyline points='6 9 12 15 18 9'%3E%3C/polyline%3E%3C/svg%3E");
      background-repeat: no-repeat;
      background-position: right 14px center;
      background-size: 16px;
      padding-right: 40px;
    }

    .license-select:hover {
      border-color: #1a237e;
      box-shadow: 0 2px 8px rgba(26, 35, 126, 0.1);
    }

    .license-select:focus {
      outline: none;
      border-color: #1a237e;
      box-shadow: 0 0 0 3px rgba(26, 35, 126, 0.1);
    }

    /* Checkbox Container Styles */
    .checkbox-container {
      display: flex;
      align-items: center;
      margin: 16px 0;
      cursor: pointer;
    }

    .checkbox-container input[type="checkbox"] {
      margin: 0;
      margin-right: 10px;
      width: 18px;
      height: 18px;
      cursor: pointer;
    }

    .checkbox-container label {
      cursor: pointer;
      font-size: 16px;
      color: #1a237e;
      display: flex;
      align-items: center;
    }

    /* Update existing service options to accommodate new styles */
    .service-options {
      padding: 24px;
      background-color: #ffffff;
      border-radius: 20px;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.04);
      margin-bottom: 24px;
      border: 1px solid rgba(0, 0, 0, 0.03);
    }

    /* Add these specific styles for checkbox alignment */
    .checkbox-wrapper {
      display: flex;
      align-items: center;
      gap: 8px;
      margin: 8px 0;
    }

    .checkbox-wrapper input[type="checkbox"] {
      margin: 0;
      width: 18px;
      height: 18px;
    }

    .checkbox-wrapper label {
      display: flex;
      align-items: center;
      gap: 8px;
      cursor: pointer;
      font-size: 16px;
      color: #1a237e;
    }

    .checkbox-wrapper .tooltip {
      margin: 0;
      display: flex;
      align-items: center;
    }

    /* Add these styles for the modern button */
    .modern-button {
      padding: 10px 20px;
      background: linear-gradient(135deg, #007bb5 0%, #005f8d 100%);
      color: white;
      border: none;
      border-radius: 8px;
      font-size: 16px;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 8px;
      transition: all 0.3s ease;
    }

    .modern-button:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(0, 123, 181, 0.2);
    }

    .modern-button .tooltip {
      margin-left: 4px;
    }
  </style>
  <script>
    // MSAL Configuration
    const msalConfig = {
      auth: {
        clientId: "63576da9-88bf-46f2-adea-326796514979",
        authority: "https://login.microsoftonline.com/a05d37d6-5a0d-4083-887d-6b340796809a",
        redirectUri: "https://smallcharbel.github.io/CalcTest/index.html",
      },
      cache: {
        cacheLocation: "sessionStorage",
        storeAuthStateInCookie: false
      }
    };
    const msalInstance = new msal.PublicClientApplication(msalConfig);
    // Check authentication on page load
    async function checkAuth() {
      try {
        const response = await msalInstance.handleRedirectPromise();
        const accounts = msalInstance.getAllAccounts();
        if (accounts.length === 0) {
          window.location.href = 'login.html';
          return;
        }
        document.addEventListener('DOMContentLoaded', () => {
          const sidebar = document.querySelector('.sidebar');
          if (sidebar) {
            const userInfo = document.createElement('div');
            userInfo.style.color = 'white';
            userInfo.style.padding = '10px';
            userInfo.style.marginTop = 'auto';
            userInfo.textContent = `Signed in as: ${accounts[0].username}`;
            sidebar.appendChild(userInfo);
            const logoutButton = document.createElement('a');
            logoutButton.textContent = 'Sign Out';
            logoutButton.style.backgroundColor = '#dc3545';
            logoutButton.style.color = 'white';
            logoutButton.style.cursor = 'pointer';
            logoutButton.style.padding = '10px';
            logoutButton.style.marginTop = '10px';
            logoutButton.style.borderRadius = '4px';
            logoutButton.style.textAlign = 'center';
            logoutButton.onclick = () => {
              msalInstance.logoutRedirect({
                postLogoutRedirectUri: 'login.html'
              });
            };
            sidebar.appendChild(logoutButton);
          }
        });
      } catch (error) {
        console.error(error);
        window.location.href = 'login.html';
      }
    }
    checkAuth();

    /***********************
     * Cost Calculation Functions (unchanged)
     ***********************/
    function calculateSentinelCost() {
      const instances = document.getElementById('sentinel-instances').value;
      const extraRules = document.getElementById('sentinel-extra-rules').value;
      const baseHours = 120;
      const extraRuleCost = extraRules * 5;
      const totalHours = instances * (baseHours + extraRuleCost);
      return totalHours * 190; // Assuming $190 per hour
    }
    function toggleExtraRules() {
  const extraRulesSection = document.getElementById("extra-rules-section");
  if (extraRulesSection.style.display === "none" || extraRulesSection.style.display === "") {
    extraRulesSection.style.display = "block";
  } else {
    extraRulesSection.style.display = "none";
  }
}

    function calculateEntraCost() {
      const tenants = document.getElementById('entra-tenants').value;
      const usersPerTenant = document.getElementById('entra-users-per-tenant').value;
      let hoursPerTenant;
      if (usersPerTenant <= 300) { hoursPerTenant = 20; }
      else if (usersPerTenant <= 750) { hoursPerTenant = 30; }
      else if (usersPerTenant <= 1000) { hoursPerTenant = 40; }
      else { alert("Please contact sales for tenants with more than 1000 users."); return 0; }
      const advancedHuntingCost = document.getElementById('entra-advanced-hunting-checkbox').checked ? tenants * 20 * 190 : 0;
      const serviceCost = tenants * hoursPerTenant * 190;
      return serviceCost + advancedHuntingCost;
    }
    function calculateCost(quantityId, rate) {
      const quantity = document.getElementById(quantityId).value;
      return quantity * rate;
    }
    function calculateExchangeCost() {
      const tenants = document.getElementById('tenants').value;
      const usersPerTenant = document.getElementById('users-per-tenant').value;
      let hoursPerTenant;
      if (usersPerTenant <= 300) { hoursPerTenant = 80; }
      else if (usersPerTenant <= 750) { hoursPerTenant = 120; }
      else if (usersPerTenant <= 1000) { hoursPerTenant = 160; }
      else { alert("Please contact Account Executive for tenants with more than 1000 users."); return 0; }
      const advancedHuntingCost = document.getElementById('advanced-hunting-checkbox').checked ? tenants * 20 * 190 : 0;
      const serviceCost = tenants * hoursPerTenant * 190;
      return serviceCost + advancedHuntingCost;
    }
    function calculateCloudAppsCost() {
      const tenants = document.getElementById('cloudapps-tenants').value;
      const usersPerTenant = document.getElementById('cloudapps-users-per-tenant').value;
      let hoursPerTenant;
      if (usersPerTenant <= 300) { hoursPerTenant = 80; }
      else if (usersPerTenant <= 750) { hoursPerTenant = 120; }
      else if (usersPerTenant <= 1000) { hoursPerTenant = 160; }
      else { alert("Please contact Account Executive for tenants with more than 1000 users."); return 0; }
      const advancedHuntingCost = document.getElementById('cloudapps-advanced-hunting-checkbox').checked ? tenants * 20 * 190 : 0;
      const serviceCost = tenants * hoursPerTenant * 190;
      return serviceCost + advancedHuntingCost;
    }
    function calculateEndpointCost() {
      const devices = document.getElementById('devices').value;
      const vulnMgmtDevices = document.getElementById('vuln-mgmt-checkbox').checked ? document.getElementById('vuln-mgmt-devices').value : 0;
      const deviceCost = devices * 150;
      const vulnMgmtCost = vulnMgmtDevices * 50;
      return deviceCost + vulnMgmtCost;
    }
    function calculateIdentityCost() {
      const tenants = document.getElementById('identity-tenants').value;
      const usersPerTenant = document.getElementById('identity-users-per-tenant').value;
      let hoursPerTenant;
      if (usersPerTenant <= 300) { hoursPerTenant = 40; }
      else if (usersPerTenant <= 750) { hoursPerTenant = 60; }
      else if (usersPerTenant <= 1000) { hoursPerTenant = 80; }
      else { alert("Please contact sales for tenants with more than 1000 users."); return 0; }
      const advancedHuntingCost = document.getElementById('identity-advanced-hunting-checkbox').checked ? tenants * 20 * 190 : 0;
      const serviceCost = tenants * hoursPerTenant * 190;
      return serviceCost + advancedHuntingCost;
    }
    function updateIntuneTable() {
  const sku = document.getElementById('intune-sku-select').value;
  const tbody = document.querySelector('#intuneTable tbody');
  tbody.innerHTML = '';

  // For features 1-7, all SKUs include them.
  // For features 8-10, they are only included if the SKU is "Microsoft Intune Plan 2" or "Microsoft Intune Suite".
  const advancedIncluded = (sku === "Microsoft Intune Plan 2" || sku === "Microsoft Intune Suite");

  // Define the list of features.
  const features = [
    { name: "Cross-Platform Endpoint Management", description: "Manage devices across Windows, macOS, iOS, and Android platforms.", type: "basic" },
    { name: "Mobile Application Management (MAM)", description: "Manage and protect corporate data within mobile apps.", type: "basic" },
    { name: "Endpoint Security", description: "Implement security policies to protect devices and data.", type: "basic" },
    { name: "Conditional Access", description: "Control access to apps and data based on conditions.", type: "basic" },
    { name: "Compliance Policies", description: "Define and enforce compliance policies for devices.", type: "basic" },
    { name: "Device Configuration", description: "Configure device settings and profiles.", type: "basic" },
    { name: "Endpoint Analytics", description: "Gain insights into device performance and user experience.", type: "basic" },
    { name: "Microsoft Tunnel for Mobile Application Management", description: "A lightweight VPN solution for iOS and Android devices that does not require device enrollment.", type: "advanced" },
    { name: "Management of Specialty Devices", description: "Manage and protect special-purpose devices such as AR/VR headsets and conference room devices.", type: "advanced" },
    { name: "Advanced Endpoint Management", description: "Advanced capabilities for managing and securing endpoints.", type: "advanced" }
  ];

  features.forEach(feature => {
    const row = document.createElement('tr');

    const nameCell = document.createElement('td');
    nameCell.style.border = "1px solid #ccc";
    nameCell.style.padding = "8px";
    nameCell.textContent = feature.name;

    const descCell = document.createElement('td');
    descCell.style.border = "1px solid #ccc";
    descCell.style.padding = "8px";
    descCell.textContent = feature.description;

    const includedCell = document.createElement('td');
    includedCell.style.border = "1px solid #ccc";
    includedCell.style.padding = "8px";
    let isIncluded = false;
    if (feature.type === "basic") {
      isIncluded = true; // Features 1-7 are always included
    } else if (feature.type === "advanced") {
      isIncluded = advancedIncluded;
    }
    includedCell.textContent = isIncluded ? "Yes" : "No";
    includedCell.className = isIncluded ? "yes" : "no";

    row.appendChild(nameCell);
    row.appendChild(descCell);
    row.appendChild(includedCell);
    tbody.appendChild(row);
  });
}

    /***********************
     * Billing Functions (unchanged)
     ***********************/
    let totalCost = 0;
    function addToBill(serviceName, cost, details) {
      const billItems = document.getElementById('bill-items');
      const existingItem = Array.from(billItems.children).find(item => item.querySelector('.item-header span:first-child').textContent === serviceName);
      let detailsText = '';
      if (details.tenants) { detailsText = `Tenants: ${details.tenants}, Users per Tenant: ${details.users}`; }
      if (details.advancedHunting) { detailsText += ", Advanced Hunting Included"; }
      if (details.instances) { detailsText = `Instances: ${details.instances}`; }
      if (details.extraRules) { detailsText += `, Extra Rules: ${details.extraRules}`; }
      if (details.devices) { detailsText = `Devices: ${details.devices}`; }
      if (details.vulnMgmtDevices) { detailsText += `, Vulnerability Management: ${details.vulnMgmtDevices} Devices`; }
      if (existingItem) {
        const itemDetails = existingItem.querySelector('.item-details');
        const itemPrice = existingItem.querySelector('.item-price');
        itemDetails.textContent = detailsText;
        const previousCost = parseFloat(itemPrice.dataset.previousCost || 0);
        itemPrice.textContent = `$${cost.toFixed(2)}`;
        totalCost = totalCost - previousCost + cost;
        itemPrice.dataset.previousCost = cost.toFixed(2);
      } else {
        totalCost += cost;
        const billItem = document.createElement('div');
        billItem.classList.add('bill-item');
        billItem.innerHTML = `
          <div class="item-header">
            <span>${serviceName}</span>
            <span class="item-price" data-previous-cost="${cost.toFixed(2)}">$${cost.toFixed(2)}</span>
            <span class="remove-item" onclick="removeItem(this, ${cost})">X</span>
          </div>
          <div class="item-details">${detailsText}</div>
        `;
        billItems.appendChild(billItem);
      }
      document.getElementById('total-cost').textContent = totalCost.toFixed(2);
    }
    function removeItem(element, cost) {
      const billItem = element.parentElement.parentElement;
      const previousCost = parseFloat(billItem.querySelector('.item-price').dataset.previousCost);
      billItem.remove();
      totalCost -= previousCost;
      document.getElementById('total-cost').textContent = totalCost.toFixed(2);
      if (totalCost < 0) { totalCost = 0; }
    }
    function exportToExcel() {
      const companyName = prompt("Enter the Company Name:");
      if (!companyName) { alert("Company name is required to export the file."); return; }
      const data = [];
      const billItems = document.querySelectorAll('.bill-item');
      data.push([`${companyName}`]);
      data.push(['Service Name', 'Price', 'Details']);
      billItems.forEach(item => {
        const serviceName = item.querySelector('.item-header span:first-child').textContent;
        const price = item.querySelector('.item-price').textContent;
        const details = item.querySelector('.item-details').textContent.trim();
        data.push([serviceName, price, details]);
      });
      data.push([]);
      data.push(['Total Cost', document.getElementById('total-cost').textContent]);
      const ws = XLSX.utils.aoa_to_sheet(data);
      const wb = XLSX.utils.book_new();
      XLSX.utils.book_append_sheet(wb, ws, "Bill Summary");
      XLSX.writeFile(wb, `${companyName}_BillSummary.xlsx`);
    }
    function toggleVulnerabilityManagement() {
      const vulnMgmtCheckbox = document.getElementById('vuln-mgmt-checkbox');
      const vulnMgmtOptions = document.getElementById('vuln-mgmt-options');
      vulnMgmtOptions.style.display = vulnMgmtCheckbox.checked ? 'block' : 'none';
    }
    function updateEndpointTable() {
  const sku = document.getElementById('endpoint-sku-select').value;
  const tbody = document.querySelector('#endpointTable tbody');
  tbody.innerHTML = '';

  // Determine feature availability based on the selected SKU
  // For "Plan 1 (P1)": Only Plan 1 features are included.
  // For "Plan 2 (P2)": Both Plan 1 and Plan 2 features are included.
  // For Microsoft 365 SKUs (E5, A5, F5, G5): All features are included.
  let includePlan1 = false;
  let includePlan2 = false;
  let includeM365 = false;
  if(sku === "Microsoft Defender for Endpoint Plan 1 (P1)") {
      includePlan1 = true;
      includePlan2 = false;
      includeM365 = false;
  } else if(sku === "Microsoft Defender for Endpoint Plan 2 (P2)") {
      includePlan1 = true;
      includePlan2 = true;
      includeM365 = false;
  } else {
      // For Microsoft 365 E5, A5, F5, G5—include all Defender features.
      includePlan1 = true;
      includePlan2 = true;
      includeM365 = true;
  }

  // Define the features for each section.
  const plan1Features = [
    { name: "Next-Generation Protection", description: "Robust antimalware and antivirus protection, including behavior-based, heuristic, and real-time protection." },
    { name: "Attack Surface Reduction (ASR)", description: "Capabilities to harden devices and prevent zero-day attacks." },
    { name: "Manual Response Actions", description: "Actions such as quarantining files and isolating devices." },
    { name: "Centralized Configuration and Management", description: "Integration with Microsoft Intune and management through the Microsoft Defender portal." },
    { name: "Cross-Platform Protection", description: "Support for Windows, macOS, iOS, and Android devices." }
  ];

  const plan2Features = [
    { name: "Endpoint Detection and Response (EDR)", description: "Advanced threat detection and response capabilities." },
    { name: "Threat and Vulnerability Management (TVM)", description: "Identifies, assesses, and remediates endpoint vulnerabilities." },
    { name: "Automated Investigation and Remediation (AIR)", description: "Automates the investigation and remediation of threats." },
    { name: "Threat Intelligence", description: "Provides detailed threat intelligence and analysis." },
    { name: "Advanced Hunting", description: "Allows security teams to proactively hunt for threats using custom queries." },
    { name: "Microsoft Threat Experts", description: "Access to Microsoft's team of security experts for additional support." }
  ];

  // Add a section header row for Plan 1 features.
  let row = document.createElement('tr');
  let cell = document.createElement('td');
  cell.colSpan = 3;
  cell.style.backgroundColor = "#e0e0e0";
  cell.style.fontWeight = "bold";
  cell.style.textAlign = "center";
  cell.style.border = "1px solid #ccc";
  cell.style.padding = "8px";
  cell.textContent = "Microsoft Defender for Endpoint Plan 1 (P1)";
  row.appendChild(cell);
  tbody.appendChild(row);

  // Add rows for each Plan 1 feature.
  plan1Features.forEach(feature => {
    row = document.createElement('tr');
    const nameCell = document.createElement('td');
    nameCell.style.border = "1px solid #ccc";
    nameCell.style.padding = "8px";
    nameCell.textContent = feature.name;

    const descCell = document.createElement('td');
    descCell.style.border = "1px solid #ccc";
    descCell.style.padding = "8px";
    descCell.textContent = feature.description;

    const availCell = document.createElement('td');
    availCell.style.border = "1px solid #ccc";
    availCell.style.padding = "8px";
    availCell.textContent = includePlan1 ? "Yes" : "No";
    availCell.className = includePlan1 ? "yes" : "no";

    row.appendChild(nameCell);
    row.appendChild(descCell);
    row.appendChild(availCell);
    tbody.appendChild(row);
  });

  // Add a section header row for Plan 2 features.
  row = document.createElement('tr');
  cell = document.createElement('td');
  cell.colSpan = 3;
  cell.style.backgroundColor = "#e0e0e0";
  cell.style.fontWeight = "bold";
  cell.style.textAlign = "center";
  cell.style.border = "1px solid #ccc";
  cell.style.padding = "8px";
  cell.textContent = "Microsoft Defender for Endpoint Plan 2 (P2)";
  row.appendChild(cell);
  tbody.appendChild(row);

  // Add rows for each Plan 2 feature.
  plan2Features.forEach(feature => {
    row = document.createElement('tr');
    const nameCell = document.createElement('td');
    nameCell.style.border = "1px solid #ccc";
    nameCell.style.padding = "8px";
    nameCell.textContent = feature.name;

    const descCell = document.createElement('td');
    descCell.style.border = "1px solid #ccc";
    descCell.style.padding = "8px";
    descCell.textContent = feature.description;

    const availCell = document.createElement('td');
    availCell.style.border = "1px solid #ccc";
    availCell.style.padding = "8px";
    availCell.textContent = includePlan2 ? "Yes" : "No";
    availCell.className = includePlan2 ? "yes" : "no";

    row.appendChild(nameCell);
    row.appendChild(descCell);
    row.appendChild(availCell);
    tbody.appendChild(row);
  });

  // Add a final row to note Microsoft 365 Security.
  row = document.createElement('tr');
  cell = document.createElement('td');
  cell.colSpan = 3;
  cell.style.backgroundColor = "#e0e0e0";
  cell.style.fontWeight = "bold";
  cell.style.textAlign = "center";
  cell.style.border = "1px solid #ccc";
  cell.style.padding = "8px";
  if(includeM365) {
    cell.textContent = "Microsoft 365 E5/A5/F5/G5 Security: All Defender for Endpoint features are included plus additional Microsoft 365 security features.";
  } else {
    cell.textContent = "Microsoft 365 E5/A5/F5/G5 Security";
  }
  row.appendChild(cell);
  tbody.appendChild(row);
}

    /***********************
     * Dynamic SKU Table Code for Exchange Online Protection Tab
     ***********************/
    // SKU Mapping and Feature Arrays (as previously defined)
    const skuMapping = {
      "Microsoft 365 Business Basic":         { endpoint: "P2", office: "", extra: false },
      "Microsoft 365 Business Standard":      { endpoint: "P2", office: "", extra: false },
      "Microsoft 365 Business Premium":       { endpoint: "P2", office: "", extra: false },
      "Microsoft 365 E3":                     { endpoint: "P2", office: "", extra: false },
      "Microsoft 365 E5":                     { endpoint: "P2", office: "P2",  extra: true  },
      "Microsoft 365 A1/A3/A5":               { endpoint: "P2", office: "P2",  extra: true  },
      "Microsoft 365 F1/F3/F5":                  { endpoint: "P2", office: "P2", extra: true },
      "Exchange Online Plan 1":               { endpoint: "P1", office: "", extra: false },
      "Exchange Online Plan 2":               { endpoint: "P2", office: "", extra: false },
      "Standalone EOP":                       { endpoint: "P2", office: "", extra: false },
      "Microsoft Defender for Office 365 P1": { endpoint: "", office: "P1", extra: false },
      "Microsoft Defender for Office 365 P2": { endpoint: "", office: "P2", extra: false }
    };
    const endpointP1Features = [
      { name: "Next-Generation Protection", description: "Robust antimalware and antivirus protection, including behavior‑based, heuristic, and real‑time protection." },
      { name: "Attack Surface Reduction (ASR)", description: "Capabilities to harden devices and prevent zero‑day attacks." },
      { name: "Manual Response Actions", description: "Actions such as quarantining files and isolating devices." },
      { name: "Centralized Configuration and Management", description: "Integration with Microsoft Intune and management via the Microsoft Defender portal." },
      { name: "Cross‑Platform Protection", description: "Support for Windows, macOS, iOS, and Android devices." }
    ];
    const endpointP2Features = [
      { name: "Endpoint Detection and Response (EDR)", description: "Advanced threat detection and response capabilities." },
      { name: "Threat and Vulnerability Management (TVM)", description: "Identifies, assesses, and remediates endpoint vulnerabilities." },
      { name: "Automated Investigation and Remediation (AIR)", description: "Automates the investigation and remediation of threats." },
      { name: "Threat Intelligence", description: "Provides detailed threat intelligence and analysis." },
      { name: "Microsoft Threat Experts", description: "Access to Microsoft's team of security experts for additional support." }
    ];
    const officeP1Features = [
      { name: "Safe Attachments", description: "Protects against unknown malware and viruses by scanning email attachments." },
      { name: "Safe Links", description: "Provides time‑of‑click verification of URLs to protect against malicious links." },
      { name: "Anti‑Phishing Policies", description: "Detects and blocks phishing attempts." },
      { name: "Real‑Time Detection", description: "Monitors and alerts on suspicious activities in real‑time." },
      { name: "Quarantine", description: "Isolates potentially harmful emails for review." },
      { name: "Reporting and Insights", description: "Provides detailed reports and insights on threats and security incidents." }
    ];
    const officeP2Features = [
      { name: "Threat Explorer", description: "Advanced threat hunting and investigation tool." },
      { name: "Automated Investigation and Response (AIR)", description: "Automates the investigation and remediation of threats." },
      { name: "Attack Simulation Training", description: "Simulates phishing attacks to train users on recognizing and responding to threats." },
      { name: "Advanced Threat Protection (ATP) for SharePoint, OneDrive, and Teams", description: "Extends protection to files stored in SharePoint, OneDrive, and Teams." },
      { name: "Threat Intelligence", description: "Provides detailed threat intelligence and analysis." }
    ];
    const additionalM365Features = [
      { name: "Conditional Access", description: "Advanced access controls across Microsoft 365 applications." },
      { name: "Identity Protection", description: "Comprehensive identity security to protect against unauthorized access." }
    ];
    // Function to populate the SKU dropdown
    function populateSKU() {
      const skuSelect = document.getElementById("skuSelect");
      skuSelect.innerHTML = "";
      Object.keys(skuMapping).forEach(sku => {
        const option = document.createElement("option");
        option.value = sku;
        option.textContent = sku;
        skuSelect.appendChild(option);
      });
      skuSelect.addEventListener("change", updateTables);
    }
    // Function to update the dynamic tables based on the selected SKU
    function updateTables() {
      const skuSelect = document.getElementById("skuSelect");
      const selectedSKU = skuSelect.value;
      const skuData = skuMapping[selectedSKU];
      let row, cell;
      // Update Defender for Endpoint Table
      const endpointTbody = document.querySelector("#endpointTable tbody");
      endpointTbody.innerHTML = "";
      // Section Header: Plan 1 Features
      row = document.createElement("tr");
      cell = document.createElement("td");
      cell.textContent = "Plan 1 Features";
      cell.colSpan = 3;
      cell.className = "section-header";
      row.appendChild(cell);
      endpointTbody.appendChild(row);
      endpointP1Features.forEach(feature => {
        row = document.createElement("tr");
        cell = document.createElement("td");
        cell.textContent = feature.name;
        row.appendChild(cell);
        cell = document.createElement("td");
        cell.textContent = feature.description;
        row.appendChild(cell);
        cell = document.createElement("td");
        const availableP1 = (skuData.endpoint === "P1" || skuData.endpoint === "P2");
        cell.textContent = availableP1 ? "Yes" : "No";
        cell.className = availableP1 ? "yes" : "no";
        row.appendChild(cell);
        endpointTbody.appendChild(row);
      });
      // Section Header: Plan 2 Features
      row = document.createElement("tr");
      cell = document.createElement("td");
      cell.textContent = "Plan 2 Features";
      cell.colSpan = 3;
      cell.className = "section-header";
      row.appendChild(cell);
      endpointTbody.appendChild(row);
      endpointP2Features.forEach(feature => {
        row = document.createElement("tr");
        cell = document.createElement("td");
        cell.textContent = feature.name;
        row.appendChild(cell);
        cell = document.createElement("td");
        cell.textContent = feature.description;
        row.appendChild(cell);
        cell = document.createElement("td");
        const availableP2 = (skuData.endpoint === "P2");
        cell.textContent = availableP2 ? "Yes" : "No";
        cell.className = availableP2 ? "yes" : "no";
        row.appendChild(cell);
        endpointTbody.appendChild(row);
      });
      // Update Defender for Office 365 Table
      const officeTbody = document.querySelector("#officeTable tbody");
      officeTbody.innerHTML = "";
      row = document.createElement("tr");
      cell = document.createElement("td");
      cell.textContent = "Plan 1 Features";
      cell.colSpan = 3;
      cell.className = "section-header";
      row.appendChild(cell);
      officeTbody.appendChild(row);
      officeP1Features.forEach(feature => {
        row = document.createElement("tr");
        cell = document.createElement("td");
        cell.textContent = feature.name;
        row.appendChild(cell);
        cell = document.createElement("td");
        cell.textContent = feature.description;
        row.appendChild(cell);
        cell = document.createElement("td");
        const availableOfficeP1 = (skuData.office === "P1" || skuData.office === "P2");
        cell.textContent = availableOfficeP1 ? "Yes" : "No";
        cell.className = availableOfficeP1 ? "yes" : "no";
        row.appendChild(cell);
        officeTbody.appendChild(row);
      });
      row = document.createElement("tr");
      cell = document.createElement("td");
      cell.textContent = "Plan 2 Features";
      cell.colSpan = 3;
      cell.className = "section-header";
      row.appendChild(cell);
      officeTbody.appendChild(row);
      officeP2Features.forEach(feature => {
        row = document.createElement("tr");
        cell = document.createElement("td");
        cell.textContent = feature.name;
        row.appendChild(cell);
        cell = document.createElement("td");
        cell.textContent = feature.description;
        row.appendChild(cell);
        cell = document.createElement("td");
        const availableOfficeP2 = (skuData.office === "P2");
        cell.textContent = availableOfficeP2 ? "Yes" : "No";
        cell.className = availableOfficeP2 ? "yes" : "no";
        row.appendChild(cell);
        officeTbody.appendChild(row);
      });
      // Update Additional Microsoft 365 Security Features Table
      const m365Tbody = document.querySelector("#m365Table tbody");
      m365Tbody.innerHTML = "";
      additionalM365Features.forEach(feature => {
        row = document.createElement("tr");
        cell = document.createElement("td");
        cell.textContent = feature.name;
        row.appendChild(cell);
        cell = document.createElement("td");
        cell.textContent = feature.description;
        row.appendChild(cell);
        cell = document.createElement("td");
        const availableExtra = skuData.extra;
        cell.textContent = availableExtra ? "Yes" : "No";
        cell.className = availableExtra ? "yes" : "no";
        row.appendChild(cell);
        m365Tbody.appendChild(row);
      });
    }
    // Function to initialize the dynamic table and input fields for EOP
    function initEOPTable() {
      const container = document.createElement('div');
      container.className = 'dynamic-table-container';
      container.innerHTML = `
        <div class="service-options">
          <label for="tenants"><strong>Number of Tenants</strong>
            <span class="tooltip">?
              <span class="tooltiptext">A tenant represents a separate Microsoft 365 instance (e.g., a separate subscription or division).</span>
            </span>
          </label>
          <input type="number" id="tenants" value="1" min="1">
          <label for="users-per-tenant"><strong>Number of Users per Tenant</strong>
            <span class="tooltip">?
              <span class="tooltiptext">The total number of users that need to be protected within each tenant.</span>
            </span>
          </label>
          <input type="number" id="users-per-tenant" value="1" min="1">
        </div>
        <div class="service-options">
          <div class="checkbox-wrapper">
            <input type="checkbox" id="advanced-hunting-checkbox">
            <label for="advanced-hunting-checkbox">
              Include Advanced Hunting
              <span class="tooltip">?
                <span class="tooltiptext">Advanced Hunting enables proactive inspection of data for potential threats using custom queries.</span>
              </span>
            </label>
          </div>
        </div>
        <label for="skuSelect"><strong>Select a License SKU:</strong></label>
        <select id="skuSelect"></select>
        <h2>Exchange Online Protection Features</h2>
        <table id="endpointTable">
          <thead>
            <tr>
              <th>Feature Name</th>
              <th>Feature Description</th>
              <th>Availability</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
        <h2>Microsoft Defender for Office 365 Features</h2>
        <table id="officeTable">
          <thead>
            <tr>
              <th>Feature Name</th>
              <th>Feature Description</th>
              <th>Availability</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
        <h2>Additional Microsoft 365 Security Features</h2>
        <table id="m365Table">
          <thead>
            <tr>
              <th>Feature Name</th>
              <th>Feature Description</th>
              <th>Availability</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      `;
      const serviceDetails = document.getElementById('service-details');
      serviceDetails.innerHTML = "";
      serviceDetails.appendChild(container);
      populateSKU();
      updateTables();
    }
    /***********************
     * Service Selection Logic
     ***********************/
    function showService(service) {
      const serviceDetails = document.getElementById('service-details');
      const serviceTitle = document.getElementById('service-title');
      serviceDetails.innerHTML = ''; // Clear previous content
      if (service === 'exchange') {
        serviceTitle.textContent = 'Microsoft Defender for Office 365/EOP';
        // Initialize the dynamic table and input fields for EOP
        initEOPTable();
        // Add the "Add to Bill" button below the dynamic table container
        const addBtn = document.createElement("button");
        addBtn.className = "add-to-bill";
        addBtn.textContent = "Add to Bill";
        addBtn.onclick = function() {
          const tenants = document.getElementById('tenants').value;
          const users = document.getElementById('users-per-tenant').value;
          const advHunting = document.getElementById('advanced-hunting-checkbox').checked;
          addToBill('Exchange Online Protection', calculateExchangeCost(), { tenants: tenants, users: users, advancedHunting: advHunting });
        };
        serviceDetails.appendChild(addBtn);
      } else if (service === 'defender') {
  serviceTitle.textContent = 'Microsoft Defender for Cloud';
  serviceDetails.innerHTML = `
    <div class="service-options">
      <label for="workloads">Number of Azure Workloads 
        <span class="tooltip">?
          <span class="tooltiptext">Examples: VM, Storage, Database, Server, etc.</span>
        </span>
      </label>
      <input type="number" id="workloads" value="1" min="1">
    </div>
    <button class="add-to-bill" onclick="addToBill('Microsoft Defender for Cloud', calculateCost('workloads', 150), {workloads: document.getElementById('workloads').value})">Add to Bill</button>
    <table class="defender-table" style="width:100%; border-collapse:collapse; margin-top:20px;">
      <thead>
        <tr>
          <th style="border:1px solid #ccc; padding:8px; background-color:#30475e; color:#fff; width:30%;">Feature/Service</th>
          <th style="border:1px solid #ccc; padding:8px; background-color:#30475e; color:#fff; width:50%;">Description</th>
          <th style="border:1px solid #ccc; padding:8px; background-color:#30475e; color:#fff; width:20%;">Included in</th>
        </tr>
      </thead>
      <tbody>
        <!-- Cloud Security Posture Management (CSPM) -->
        <tr style="background-color:#e0e0e0; font-weight:bold; text-align:center;">
          <td colspan="3" style="border:1px solid #ccc; padding:8px;">Cloud Security Posture Management (CSPM)</td>
        </tr>
        <tr>
          <td style="border:1px solid #ccc; padding:8px;">Foundational CSPM</td>
          <td style="border:1px solid #ccc; padding:8px;">
            Provides continuous assessments, security recommendations, Secure Score, and the Microsoft cloud security benchmark across Azure, AWS, and Google Cloud.
          </td>
          <td style="border:1px solid #ccc; padding:8px;">Free Tier</td>
        </tr>
        <tr>
          <td style="border:1px solid #ccc; padding:8px;">Advanced CSPM</td>
          <td style="border:1px solid #ccc; padding:8px;">
            Includes advanced threat detection and compliance management.
          </td>
          <td style="border:1px solid #ccc; padding:8px;">Enhanced Security</td>
        </tr>
        <!-- Cloud Workload Protection (CWP) -->
        <tr style="background-color:#e0e0e0; font-weight:bold; text-align:center;">
          <td colspan="3" style="border:1px solid #ccc; padding:8px;">Cloud Workload Protection (CWP)</td>
        </tr>
        <tr>
          <td style="border:1px solid #ccc; padding:8px;">Defender for Servers</td>
          <td style="border:1px solid #ccc; padding:8px;">
            Protects virtual machines and servers with capabilities like endpoint detection and response (EDR), vulnerability management, and file integrity monitoring.
          </td>
          <td style="border:1px solid #ccc; padding:8px;">-</td>
        </tr>
        <tr>
          <td style="border:1px solid #ccc; padding:8px;">Defender for App Service</td>
          <td style="border:1px solid #ccc; padding:8px;">
            Protects web applications running on Azure App Service.
          </td>
          <td style="border:1px solid #ccc; padding:8px;">-</td>
        </tr>
        <tr>
          <td style="border:1px solid #ccc; padding:8px;">Defender for SQL</td>
          <td style="border:1px solid #ccc; padding:8px;">
            Provides advanced threat protection for SQL databases.
          </td>
          <td style="border:1px solid #ccc; padding:8px;">-</td>
        </tr>
        <tr>
          <td style="border:1px solid #ccc; padding:8px;">Defender for Storage</td>
          <td style="border:1px solid #ccc; padding:8px;">
            Protects Azure Storage accounts from threats.
          </td>
          <td style="border:1px solid #ccc; padding:8px;">-</td>
        </tr>
        <tr>
          <td style="border:1px solid #ccc; padding:8px;">Defender for Kubernetes</td>
          <td style="border:1px solid #ccc; padding:8px;">
            Secures Kubernetes clusters with threat detection and compliance monitoring.
          </td>
          <td style="border:1px solid #ccc; padding:8px;">-</td>
        </tr>
        <tr>
          <td style="border:1px solid #ccc; padding:8px;">Defender for Containers</td>
          <td style="border:1px solid #ccc; padding:8px;">
            Protects containerized applications and environments.
          </td>
          <td style="border:1px solid #ccc; padding:8px;">-</td>
        </tr>
        <!-- DevOps Security Management -->
        <tr style="background-color:#e0e0e0; font-weight:bold; text-align:center;">
          <td colspan="3" style="border:1px solid #ccc; padding:8px;">DevOps Security Management</td>
        </tr>
        <tr>
          <td style="border:1px solid #ccc; padding:8px;">CI/CD Pipeline Security</td>
          <td style="border:1px solid #ccc; padding:8px;">
            Integrates security checks into continuous integration and continuous deployment (CI/CD) pipelines.
          </td>
          <td style="border:1px solid #ccc; padding:8px;">Enhanced Security</td>
        </tr>
        <tr>
          <td style="border:1px solid #ccc; padding:8px;">Infrastructure as Code (IaC) Scanning</td>
          <td style="border:1px solid #ccc; padding:8px;">
            Scans IaC templates for security misconfigurations.
          </td>
          <td style="border:1px solid #ccc; padding:8px;">Enhanced Security</td>
        </tr>
        <!-- Threat Intelligence -->
        <tr style="background-color:#e0e0e0; font-weight:bold; text-align:center;">
          <td colspan="3" style="border:1px solid #ccc; padding:8px;">Threat Intelligence</td>
        </tr>
        <tr>
          <td style="border:1px solid #ccc; padding:8px;">Threat Detection</td>
          <td style="border:1px solid #ccc; padding:8px;">
            Uses machine learning and behavioral analytics to detect threats across cloud environments.
          </td>
          <td style="border:1px solid #ccc; padding:8px;">Enhanced Security</td>
        </tr>
        <tr>
          <td style="border:1px solid #ccc; padding:8px;">Threat Intelligence Integration</td>
          <td style="border:1px solid #ccc; padding:8px;">
            Integrates with Microsoft Threat Intelligence for comprehensive threat analysis.
          </td>
          <td style="border:1px solid #ccc; padding:8px;">Enhanced Security</td>
        </tr>
        <!-- Compliance Management -->
        <tr style="background-color:#e0e0e0; font-weight:bold; text-align:center;">
          <td colspan="3" style="border:1px solid #ccc; padding:8px;">Compliance Management</td>
        </tr>
        <tr>
          <td style="border:1px solid #ccc; padding:8px;">Regulatory Compliance</td>
          <td style="border:1px solid #ccc; padding:8px;">
            Provides compliance assessments and reporting for various regulatory standards.
          </td>
          <td style="border:1px solid #ccc; padding:8px;">Enhanced Security</td>
        </tr>
        <tr>
          <td style="border:1px solid #ccc; padding:8px;">Policy Management</td>
          <td style="border:1px solid #ccc; padding:8px;">
            Allows for the creation and enforcement of security policies.
          </td>
          <td style="border:1px solid #ccc; padding:8px;">Enhanced Security</td>
        </tr>
      </tbody>
    </table>
  `;
}
else if (service === 'cloudApps') {
  serviceTitle.textContent = 'Microsoft Defender for Cloud Apps';
  serviceDetails.innerHTML = `
    <div class="service-options">
      <label for="cloudapps-tenants">
        <strong>Number of Tenants</strong>
        <span class="tooltip">?
          <span class="tooltiptext">Each tenant represents a separate instance of your cloud environment. This number is used to determine overall resource allocation.</span>
        </span>
      </label>
      <input type="number" id="cloudapps-tenants" value="1" min="1">
      
      <label for="cloudapps-users-per-tenant">
        <strong>Number of Users per Tenant</strong>
        <span class="tooltip">?
          <span class="tooltiptext">Specifies the user count per tenant. This helps determine the appropriate level of protection and resources needed.</span>
        </span>
      </label>
      <input type="number" id="cloudapps-users-per-tenant" value="1" min="1">
    </div>

    <button class="add-to-bill" onclick="addToBill('Microsoft Defender for Cloud Apps', calculateCloudAppsCost(), {tenants: document.getElementById('cloudapps-tenants').value, users: document.getElementById('cloudapps-users-per-tenant').value})">Add to Bill</button>

    <div class="features-section" style="margin-top: 24px;">
      <p style="margin-bottom: 16px; padding: 12px; background-color: #f8f9fa; border-radius: 8px; color: #1a237e; font-style: italic;">
        All features below are included in: Microsoft 365 E5, Microsoft 365 A5, Microsoft 365 F5 Security, and Enterprise Mobility + Security E5 (EMS E5)
      </p>
      
      <table id="cloudAppsTable" style="width: 100%; border-collapse: collapse; margin-top: 16px;">
        <thead>
          <tr>
            <th style="width: 30%; background-color: #30475e; color: white; padding: 12px; text-align: left; border: 1px solid #dee2e6;">Feature Name</th>
            <th style="width: 70%; background-color: #30475e; color: white; padding: 12px; text-align: left; border: 1px solid #dee2e6;">Feature Description</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td style="padding: 12px; border: 1px solid #dee2e6;">Discovery</td>
            <td style="padding: 12px; border: 1px solid #dee2e6;">Discover and identify all cloud apps in your environment, assess their risk levels, and get detailed insights about their usage.</td>
          </tr>
          <tr>
            <td style="padding: 12px; border: 1px solid #dee2e6;">Information Protection</td>
            <td style="padding: 12px; border: 1px solid #dee2e6;">Protect sensitive information across cloud apps. Apply labels automatically, trigger alerts, and take actions when sensitive data is detected.</td>
          </tr>
          <tr>
            <td style="padding: 12px; border: 1px solid #dee2e6;">Threat Protection</td>
            <td style="padding: 12px; border: 1px solid #dee2e6;">Detect and protect against cyber threats across all your cloud services using behavioral analytics and anomaly detection.</td>
          </tr>
          <tr>
            <td style="padding: 12px; border: 1px solid #dee2e6;">App Governance</td>
            <td style="padding: 12px; border: 1px solid #dee2e6;">Monitor and control app behaviors, enforce compliance policies, and protect against app-based risks.</td>
          </tr>
          <tr>
            <td style="padding: 12px; border: 1px solid #dee2e6;">Cloud Security Posture Management</td>
            <td style="padding: 12px; border: 1px solid #dee2e6;">Assess and improve your security posture across multiple cloud platforms. Identify misconfigurations and security gaps.</td>
          </tr>
          <tr>
            <td style="padding: 12px; border: 1px solid #dee2e6;">Compliance Management</td>
            <td style="padding: 12px; border: 1px solid #dee2e6;">Ensure compliance with regulations and internal policies across all your cloud apps and services.</td>
          </tr>
        </tbody>
      </table>
    </div>
  `;
}
else if (service === 'endpoint') {
  serviceTitle.textContent = 'Microsoft Defender for Endpoint';
  serviceDetails.innerHTML = `
    <div class="service-options">
      <label for="devices">
        <strong>Number of Devices</strong>
        <span class="tooltip">?
          <span class="tooltiptext">A device can be any Windows PC, Mac, Linux machine, iOS/Android mobile device, or server that requires endpoint protection. Each physical or virtual machine counts as one device.</span>
        </span>
      </label>
      <input type="number" id="devices" value="1" min="1">
    </div>

    <div class="service-options">
      <div class="checkbox-wrapper">
        <input type="checkbox" id="vuln-mgmt-checkbox" onclick="toggleVulnerabilityManagement()">
        <label for="vuln-mgmt-checkbox">
          Include Vulnerability Management
          <span class="tooltip">?
            <span class="tooltiptext">Enables continuous monitoring and assessment of security vulnerabilities across your endpoints.</span>
          </span>
        </label>
      </div>
    </div>

    <div class="service-options">
      <div class="license-container">
        <label class="license-label">Select License</label>
        <select class="license-select" id="endpoint-sku-select" onchange="updateEndpointTable()">
          <option value="Microsoft Defender for Endpoint Plan 1 (P1)">Microsoft Defender for Endpoint Plan 1 (P1)</option>
          <option value="Microsoft Defender for Endpoint Plan 2 (P2)">Microsoft Defender for Endpoint Plan 2 (P2)</option>
          <option value="Microsoft 365 E5">Microsoft 365 E5</option>
          <option value="Microsoft 365 A5">Microsoft 365 A5</option>
          <option value="Microsoft 365 F5">Microsoft 365 F5</option>
          <option value="Microsoft 365 G5">Microsoft 365 G5</option>
        </select>
      </div>
    </div>

    <button class="add-to-bill" onclick="addToBill('Microsoft Defender for Endpoint', calculateEndpointCost(), {devices: document.getElementById('devices').value, vulnMgmtDevices: document.getElementById('vuln-mgmt-devices').value})">Add to Bill</button>
    <table id="endpointTable" style="width:100%; border-collapse:collapse; margin-top:20px;">
      <thead>
        <tr>
          <th style="border:1px solid #ccc; padding:8px; background-color:#30475e; color:#fff; width:30%;">Feature/Service</th>
          <th style="border:1px solid #ccc; padding:8px; background-color:#30475e; color:#fff; width:50%;">Description</th>
          <th style="border:1px solid #ccc; padding:8px; background-color:#30475e; color:#fff; width:20%;">Included</th>
        </tr>
      </thead>
      <tbody>
        <!-- Rows will be dynamically injected here based on the SKU selection -->
      </tbody>
    </table>
  `;
  updateEndpointTable(); // Initialize table based on the default SKU
}
 else if (service === 'identity') {
  serviceTitle.textContent = 'Microsoft Defender for Identity';
  serviceDetails.innerHTML = `
    <div class="service-options">
      <label for="identity-tenants">
        <strong>Number of Tenants</strong>
        <span class="tooltip">?
          <span class="tooltiptext">Each tenant represents a separate organizational environment that needs identity protection.</span>
        </span>
      </label>
      <input type="number" id="identity-tenants" value="1" min="1">
      
      <label for="identity-users-per-tenant">
        <strong>Number of Users per Tenant</strong>
        <span class="tooltip">?
          <span class="tooltiptext">The number of users whose identity activities need to be monitored and protected within each tenant.</span>
        </span>
      </label>
      <input type="number" id="identity-users-per-tenant" value="1" min="1">
    </div>
    <div class="service-options">
      <div class="checkbox-container">
        <input type="checkbox" id="identity-advanced-hunting-checkbox">
        <label for="identity-advanced-hunting-checkbox">
          Include Advanced Hunting
          <span class="tooltip">?
            <span class="tooltiptext">Enables deep investigation capabilities to proactively hunt for identity-based threats across your organization.</span>
          </span>
        </label>
      </div>
    </div>
    <button class="add-to-bill" onclick="addToBill('Microsoft Defender for Identity', calculateIdentityCost(), {tenants: document.getElementById('identity-tenants').value, users: document.getElementById('identity-users-per-tenant').value, advancedHunting: document.getElementById('identity-advanced-hunting-checkbox').checked})">Add to Bill</button>
    <p style="margin-top:20px; font-style: italic;">
      The below features are included in these licenses: Enterprise Mobility + Security E5 (EMS E5/A5) / Microsoft 365 E5 (Microsoft E5/A5/G5) / Microsoft 365 E5/A5/G5/F5 Security / Standalone Defender for Identity License
    </p>
    <table class="identity-table" style="width:100%; border-collapse:collapse; margin-top:10px;">
      <thead>
        <tr>
          <th style="border:1px solid #ccc; padding:8px; background-color:#30475e; color:#fff; width:40%;">Feature/Service</th>
          <th style="border:1px solid #ccc; padding:8px; background-color:#30475e; color:#fff; width:60%;">Description</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td style="border:1px solid #ccc; padding:8px;">User and Entity Behavioral Analytics (UEBA)</td>
          <td style="border:1px solid #ccc; padding:8px;">Detects suspicious activities and potential threats by analyzing user and entity behavior.</td>
        </tr>
        <tr>
          <td style="border:1px solid #ccc; padding:8px;">Advanced Threat Detection</td>
          <td style="border:1px solid #ccc; padding:8px;">Identifies advanced threats, compromised identities, and malicious insider actions.</td>
        </tr>
        <tr>
          <td style="border:1px solid #ccc; padding:8px;">Lateral Movement Path (LMP) Detection</td>
          <td style="border:1px solid #ccc; padding:8px;">Detects potential lateral movement paths that attackers might use to move within the network.</td>
        </tr>
        <tr>
          <td style="border:1px solid #ccc; padding:8px;">Security Alerts</td>
          <td style="border:1px solid #ccc; padding:8px;">Provides real-time alerts on suspicious activities and potential threats.</td>
        </tr>
        <tr>
          <td style="border:1px solid #ccc; padding:8px;">Integration with Microsoft 365 Defender</td>
          <td style="border:1px solid #ccc; padding:8px;">Integrates with other Microsoft 365 Defender products for a unified security experience.</td>
        </tr>
        <tr>
          <td style="border:1px solid #ccc; padding:8px;">Identity Security Posture Management</td>
          <td style="border:1px solid #ccc; padding:8px;">Assesses and improves the security posture of identities within the organization.</td>
        </tr>
        <tr>
          <td style="border:1px solid #ccc; padding:8px;">Incident Investigation and Response</td>
          <td style="border:1px solid #ccc; padding:8px;">Facilitates the investigation and response to security incidents involving identities.</td>
        </tr>
      </tbody>
    </table>
  `;
}
else if (service === 'entra') {
  serviceTitle.textContent = 'Microsoft Entra ID Protection';
  serviceDetails.innerHTML = `
    <div class="service-options">
      <label for="entra-tenants">
        <strong>Number of Tenants</strong>
        <span class="tooltip">?
          <span class="tooltiptext">A tenant represents a separate Microsoft 365 instance (e.g., a separate subscription or division).</span>
        </span>
      </label>
      <input type="number" id="entra-tenants" value="1" min="1">
      
      <label for="entra-users-per-tenant">
        <strong>Number of Users per Tenant</strong>
        <span class="tooltip">?
          <span class="tooltiptext">The total number of users that need identity protection within each tenant.</span>
        </span>
      </label>
      <input type="number" id="entra-users-per-tenant" value="1" min="1">
    </div>
    <div class="service-options">
      <div class="checkbox-container">
        <input type="checkbox" id="entra-advanced-hunting-checkbox">
        <label for="entra-advanced-hunting-checkbox">
          Include Advanced Hunting
          <span class="tooltip">?
            <span class="tooltiptext">Enables proactive threat hunting capabilities using custom queries to search through identity-related events and activities.</span>
          </span>
        </label>
      </div>
    </div>
    <button class="add-to-bill" onclick="addToBill('Microsoft Entra ID Protection', calculateEntraCost(), {tenants: document.getElementById('entra-tenants').value, users: document.getElementById('entra-users-per-tenant').value, advancedHunting: document.getElementById('entra-advanced-hunting-checkbox').checked})">Add to Bill</button>
    
    <div class="entra-summary" style="margin-top: 20px;">
      <h3>
        Microsoft Entra ID Protection Summary
        <span class="tooltip">?
          <span class="tooltiptext">A comprehensive identity protection service that helps secure user identities and access in your organization.</span>
        </span>
      </h3>
      <div class="card-container" style="display: flex; flex-wrap: wrap; gap: 20px; margin-top: 10px;">
        <div class="card" style="flex: 1 1 calc(50% - 20px); background: #fff; border: 1px solid #ccc; border-radius: 8px; padding: 15px; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
          <h4 style="margin-top: 0; color: #30475e;">
            Risk-Based Access Policies
            <span class="tooltip">?
              <span class="tooltiptext">Automatically adjusts access requirements based on detected risk levels during sign-in attempts.</span>
            </span>
          </h4>
          <p style="margin: 0;">Enhances security with Conditional Access that responds to sign-in risks. Evaluates authentication attempts and applies controls based on risk levels.</p>
        </div>
        <div class="card" style="flex: 1 1 calc(50% - 20px); background: #fff; border: 1px solid #ccc; border-radius: 8px; padding: 15px; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
          <h4 style="margin-top: 0; color: #30475e;">
            Advanced Risk Detection and Response
            <span class="tooltip">?
              <span class="tooltiptext">Uses machine learning to detect and respond to suspicious identity-related activities in real-time.</span>
            </span>
          </h4>
          <p style="margin: 0;">Continuously monitors identity signals for threats and unauthorized access. Automatically adjusts access policies in response to detected risks.</p>
        </div>
      </div>
    </div>
  `;
} else if (service === 'sentinel') {
  serviceTitle.textContent = 'Microsoft Sentinel';
  serviceDetails.innerHTML = `
    <div class="service-options">
      <label for="sentinel-instances">
        <strong>Number of Instances</strong>
        <span class="tooltip">?
          <span class="tooltiptext">An instance represents a separate Microsoft Sentinel workspace. Each workspace can collect and analyze data from multiple sources.</span>
        </span>
      </label>
      <input type="number" id="sentinel-instances" value="1" min="1">
    </div>

    <div class="service-options">
      <div class="checkbox-wrapper">
        <button class="modern-button" onclick="toggleExtraRules()">
          Include Rules
          <span class="tooltip">?
            <span class="tooltiptext">Rules help detect specific threats and automate responses. By default, 14 rules are included (2 Automation Rules, 5 Scheduled Analytic Rules, 5 Near Real-Time Analytic Rules, 2 Automation Rules with Playbooks).</span>
          </span>
        </button>
      </div>
      
      <div id="extra-rules-section" style="display: none; margin-top: 16px;">
        <p style="margin: 0 0 8px 0; color: #666;">Extra Rules: 14 rules included by default</p>
        <label for="sentinel-extra-rules">
          <strong>Adjust Extra Rules</strong>
        </label>
        <input type="number" id="sentinel-extra-rules" value="0" min="0">
      </div>
    </div>

    <button class="add-to-bill" onclick="addToBill('Microsoft Sentinel', calculateSentinelCost(), {instances: document.getElementById('sentinel-instances').value, extraRules: document.getElementById('sentinel-extra-rules').value})">Add to Bill</button>

    <div class="features-section" style="margin-top: 24px;">
      <table id="sentinelTable" style="width: 100%; border-collapse: collapse; margin-top: 16px;">
        <thead>
          <tr>
            <th style="width: 25%; background-color: #30475e; color: white; padding: 12px; text-align: left; border: 1px solid #dee2e6;">Feature Name</th>
            <th style="width: 75%; background-color: #30475e; color: white; padding: 12px; text-align: left; border: 1px solid #dee2e6;">Description</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td style="padding: 12px; border: 1px solid #dee2e6;">Data Collection</td>
            <td style="padding: 12px; border: 1px solid #dee2e6;">
              <strong>Out-of-Box Data Connectors:</strong> Integrates with various Microsoft and non-Microsoft sources, including Microsoft Entra ID, Azure Activity, and more.<br><br>
              <strong>Custom Data Collection:</strong> Supports data collection using common event format (CEF), Syslog, or REST-API.
            </td>
          </tr>
          <tr>
            <td style="padding: 12px; border: 1px solid #dee2e6;">Threat Detection</td>
            <td style="padding: 12px; border: 1px solid #dee2e6;">
              <strong>Built-in Analytics:</strong> Uses machine learning and behavioral analytics to detect threats.<br><br>
              <strong>Custom Analytics Rules:</strong> Allows creation of custom rules to detect specific threats.
            </td>
          </tr>
          <tr>
            <td style="padding: 12px; border: 1px solid #dee2e6;">Investigation</td>
            <td style="padding: 12px; border: 1px solid #dee2e6;">
              <strong>Investigation Graph:</strong> Visualizes relationships between entities in an alert to help investigate incidents.<br><br>
              <strong>Hunting Queries:</strong> Provides tools for proactive threat hunting using KQL (Kusto Query Language).
            </td>
          </tr>
          <tr>
            <td style="padding: 12px; border: 1px solid #dee2e6;">Response</td>
            <td style="padding: 12px; border: 1px solid #dee2e6;">
              <strong>Automated Response:</strong> Uses playbooks to automate responses to threats.<br><br>
              <strong>Manual Response Actions:</strong> Allows security teams to take manual actions based on investigation findings.
            </td>
          </tr>
          <tr>
            <td style="padding: 12px; border: 1px solid #dee2e6;">SOAR</td>
            <td style="padding: 12px; border: 1px solid #dee2e6;">
              <strong>Playbooks:</strong> Automates workflows and responses to incidents.<br><br>
              <strong>Integration with Logic Apps:</strong> Leverages Azure Logic Apps for complex automation scenarios.
            </td>
          </tr>
        </tbody>
      </table>
    </div>
  `;
}
else if (service === 'intune') {
  serviceTitle.textContent = 'Microsoft Intune';
  serviceDetails.innerHTML = `
    <div class="service-options">
      <label for="devices">
        <strong>Number of Devices</strong>
        <span class="tooltip">?
          <span class="tooltiptext">Devices can include Windows PCs, Macs, iOS/iPadOS devices, Android phones and tablets, and Windows Mobile devices. Each user can enroll multiple devices.</span>
        </span>
      </label>
      <input type="number" id="devices" value="1" min="1">
    </div>

    <div class="service-options">
      <div class="license-container">
        <label class="license-label">Select License</label>
        <select class="license-select" id="intune-sku-select" onchange="updateIntuneTable()">
          <option value="Microsoft Intune Plan 1">Microsoft Intune Plan 1</option>
          <option value="Microsoft Intune Plan 2">Microsoft Intune Plan 2</option>
          <option value="Microsoft Intune Suite">Microsoft Intune Suite</option>
          <option value="Microsoft 365 E3">Microsoft 365 E3</option>
          <option value="Microsoft 365 E5">Microsoft 365 E5</option>
          <option value="Enterprise Mobility + Security E3">Enterprise Mobility + Security E3</option>
          <option value="Enterprise Mobility + Security E5">Enterprise Mobility + Security E5</option>
          <option value="Microsoft 365 Business Premium">Microsoft 365 Business Premium</option>
          <option value="Microsoft 365 F1">Microsoft 365 F1</option>
          <option value="Microsoft 365 F3">Microsoft 365 F3</option>
        </select>
      </div>
    </div>

    <button class="add-to-bill" onclick="addToBill('Microsoft Intune', calculateEndpointCost(), {devices: document.getElementById('devices').value})">Add to Bill</button>

    <table id="intuneTable" style="width: 100%; border-collapse: collapse; margin-top: 16px;">
      <thead>
        <tr>
          <th style="width: 30%; background-color: #30475e; color: white; padding: 12px; text-align: left; border: 1px solid #dee2e6;">Feature/Service</th>
          <th style="width: 50%; background-color: #30475e; color: white; padding: 12px; text-align: left; border: 1px solid #dee2e6;">Description</th>
          <th style="width: 20%; background-color: #30475e; color: white; padding: 12px; text-align: left; border: 1px solid #dee2e6;">Included</th>
        </tr>
      </thead>
      <tbody>
      </tbody>
    </table>
  `;
  updateIntuneTable();
}

    }

    // Add this at the start of your script
    window.onload = function() {
      // Check if user is authenticated
      const user = JSON.parse(sessionStorage.getItem('user'));
      if (!user || !user.verified) {
        window.location.href = '/login.html';
        return;
      }

      // Display welcome message
      const welcomeDiv = document.createElement('div');
      welcomeDiv.style.position = 'absolute';
      welcomeDiv.style.top = '10px';
      welcomeDiv.style.right = '20px';
      welcomeDiv.style.color = '#333';
      welcomeDiv.innerHTML = `Welcome, ${user.name} | <a href="#" onclick="logout()" style="color: #007bff; text-decoration: none;">Sign Out</a>`;
      document.body.appendChild(welcomeDiv);
    }

    function logout() {
      sessionStorage.removeItem('user');
      window.location.href = '/login.html';
    }
  </script>
</head>
<body>
  <div class="sidebar">
    <img src="logo.png" alt="Company Logo" class="logo" onclick="window.location.href='https://www.ampiosolutions.com/'">
    <h2>Services</h2>
    <a onclick="showService('exchange')">Microsoft Defender for Office 365/EOP</a>
    <a onclick="showService('defender')">Microsoft Defender for Cloud</a>
    <a onclick="showService('cloudApps')">Microsoft Defender for Cloud Apps</a>
    <a onclick="showService('endpoint')">Microsoft Defender for Endpoint</a>
    <a onclick="showService('identity')">Microsoft Defender for Identity</a>
    <a onclick="showService('entra')">Microsoft Entra ID Protection</a>
    <a onclick="showService('sentinel')">Microsoft Sentinel</a>
    <a onclick="showService('intune')">Microsoft Intune</a>
  </div>
  <div class="title-bar">
    <h1>Microsoft Security Calculator</h1>
  </div>
  <div class="content">
    <h2 id="service-title">Select a Service</h2>
    <div id="service-details" class="service-options"></div>
  </div>
  <div id="bill-summary" class="bill-summary">
    <h3>Estimated Cost Of Services</h3>
    <div id="bill-items"></div>
    <div class="total-cost">Total: $<span id="total-cost">0</span></div>
    <button class="add-to-bill" onclick="exportToExcel()">Export to Excel</button>
  </div>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
</body>
</html>
